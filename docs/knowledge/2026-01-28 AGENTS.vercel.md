# Guide to Writing AGENTS.md

A comprehensive guide based on Vercel's research showing that AGENTS.md outperforms skills in agent evaluations.

## What is AGENTS.md?

AGENTS.md is a markdown file placed in your project root that provides persistent context to AI coding agents. Unlike skills (which agents must decide to invoke), everything in AGENTS.md is available to the agent on every turn without requiring a decision point.

**Key insight from Vercel's research:** A compressed 8KB docs index in AGENTS.md achieved a 100% pass rate in their evals, while skills maxed out at 79% even with explicit instructions, and performed no better than baseline (53%) without those instructions.

## Why AGENTS.md Outperforms Skills

Based on Vercel's testing, passive context beats active retrieval for three reasons:

1. **No decision point** - The agent doesn't need to decide "should I look this up?" The information is already present
2. **Consistent availability** - Content is in the system prompt for every turn, unlike skills that load asynchronously and only when invoked
3. **No ordering issues** - Skills create sequencing decisions (read docs first vs. explore project first), while passive context avoids this entirely

## Core Principles

### 1. Retrieval-Led Over Pre-Training-Led Reasoning

The most important instruction to include:

```markdown
IMPORTANT: Prefer retrieval-led reasoning over pre-training-led reasoning for any framework-specific tasks.
```

This tells the agent to consult documentation rather than rely on potentially outdated training data.

### 2. Compression is Critical

Don't bloat the context window. Vercel compressed their docs index from 40KB to 8KB (80% reduction) while maintaining 100% pass rate.

**Use pipe-delimited structure:**

```markdown
[Framework Docs Index]|root: ./.docs
|IMPORTANT: Prefer retrieval-led reasoning over pre-training-led reasoning
|section-1:{file1.md,file2.md,file3.md}
|section-2/subsection:{file4.md,file5.md}
```

### 3. Index, Don't Embed Full Content

Provide an index pointing to retrievable files rather than embedding full documentation. The agent can read specific files as needed.

## Structure Your AGENTS.md

### Basic Template

```markdown
# Project Context for AI Agents

## Project Overview

[Brief description of what this project does]

## Tech Stack

- Framework: [e.g., Next.js 16]
- Language: [e.g., TypeScript]
- Key dependencies: [list major dependencies]

## Architecture

[High-level description of your project structure]

## Documentation Index

[Compressed index of relevant docs - see below]

## Key Conventions

- [Coding standards]
- [Naming conventions]
- [File organization patterns]

## Common Tasks

[Guidance for frequent operations agents will perform]
```

### Documentation Index Format

For framework-specific knowledge, create a compressed index:

```markdown
[Next.js Docs Index]|root: ./.next-docs
|IMPORTANT: Prefer retrieval-led reasoning over pre-training-led reasoning
|01-getting-started:{installation.md,project-structure.md}
|02-routing:{defining-routes.md,pages-and-layouts.md,linking-navigating.md}
|03-data-fetching:{fetching-caching.md,server-actions.md}
|04-rendering:{server-components.md,client-components.md}
|05-styling:{css-modules.md,tailwind.md}
```

Each line maps a directory path to the doc files it contains.

## What to Include

### Essential Information

1. **Framework version** - Critical for APIs that may not be in training data
2. **Project-specific patterns** - How your team structures code
3. **Common pitfalls** - Known issues agents should avoid
4. **Build/deployment specifics** - Special requirements or configurations
5. **Testing conventions** - How to write and run tests in this project

### Version-Specific APIs

Focus on APIs not in current model training data. For Next.js 16 example:

```markdown
## Next.js 16 APIs

Consult .next-docs/ for full documentation on these APIs:

- `connection()` for dynamic rendering
- `'use cache'` directive
- `cacheLife()` and `cacheTag()`
- `forbidden()` and `unauthorized()`
- `proxy.ts` for API proxying
- Async `cookies()` and `headers()`
- `after()`, `updateTag()`, `refresh()`
```

### Project-Specific Guidance

```markdown
## Code Organization

- Components: `/src/components` - Reusable UI components
- Pages: `/src/app` - Next.js App Router pages
- Utils: `/src/lib` - Utility functions and helpers
- Types: `/src/types` - TypeScript type definitions

## Naming Conventions

- Components: PascalCase (`UserProfile.tsx`)
- Utilities: camelCase (`formatDate.ts`)
- Constants: SCREAMING_SNAKE_CASE (`API_ENDPOINTS`)
- Test files: `*.test.ts` or `*.spec.ts`
```

## Best Practices

### DO:

- ✅ Keep total size under 10KB through compression
- ✅ Use clear, scannable formatting
- ✅ Focus on information not in training data
- ✅ Point to external files for detailed docs
- ✅ Include explicit "prefer retrieval" instructions
- ✅ Update when framework versions change
- ✅ Test with actual agent workflows

### DON'T:

- ❌ Embed full documentation (use indexes instead)
- ❌ Include information readily available in training data
- ❌ Use ambiguous language
- ❌ Forget to specify framework versions
- ❌ Assume agents will "figure it out"
- ❌ Include implementation details better suited for code comments

## Example: Next.js Project

```markdown
# Next.js 16 Project - AI Agent Guide

## Overview

Full-stack web application built with Next.js 16 (App Router), TypeScript, and Tailwind CSS.

## Tech Stack

- Framework: Next.js 16.0.0
- Language: TypeScript 5.3
- Styling: Tailwind CSS 3.4
- Database: PostgreSQL via Prisma
- Auth: NextAuth.js v5

## Next.js 16 Documentation

[Next.js 16 Docs]|root: ./.next-docs
|IMPORTANT: Prefer retrieval-led reasoning over pre-training-led reasoning for Next.js APIs
|app/getting-started:{installation.mdx,project-structure.mdx}
|app/routing:{defining-routes.mdx,pages-layouts.mdx,dynamic-routes.mdx}
|app/data-fetching:{server-actions.mdx,caching.mdx,use-cache.mdx}
|app/rendering:{server-components.mdx,client-components.mdx,connection.mdx}
|app/functions:{forbidden.mdx,unauthorized.mdx,after.mdx}

## Architecture
```

src/
├── app/ # Next.js App Router pages
├── components/ # Reusable React components
│ ├── ui/ # Base UI components
│ └── features/ # Feature-specific components
├── lib/ # Utility functions
├── types/ # TypeScript definitions
└── styles/ # Global styles

```

## Key Conventions

### Server Components by Default
All components in the app directory are Server Components unless marked with `'use client'`.

### Data Fetching
- Use `'use cache'` directive for cached data fetching
- Use `connection()` to force dynamic rendering when needed
- Server Actions in separate files with `'use server'` directive

### Error Handling
- Use `forbidden()` for 403 errors
- Use `unauthorized()` for 401 errors
- Implement error boundaries with `error.tsx`

## Common Tasks

### Creating a New Page
1. Create file in `src/app/[route]/page.tsx`
2. Export default async function component
3. Add metadata export for SEO

### Adding API Route
1. Create `route.ts` in `src/app/api/[endpoint]/`
2. Export named functions: GET, POST, etc.
3. Return Response objects

### Database Queries
- Use Prisma client from `src/lib/db`
- Wrap in `'use cache'` with appropriate `cacheTag`
- Call `updateTag()` after mutations

## Build & Deploy

Build: `npm run build`
Dev: `npm run dev`
Test: `npm run test`
Lint: `npm run lint`

Environment variables must be in `.env.local` (not committed)
Required: `DATABASE_URL`, `NEXTAUTH_SECRET`, `NEXTAUTH_URL`
```

## Automation

For Next.js projects, Vercel provides a command:

```bash
npx @next/codemod@canary agents-md
```

This automatically:

1. Detects your Next.js version
2. Downloads matching documentation to `.next-docs/`
3. Injects the compressed index into `AGENTS.md`

## When to Use AGENTS.md vs Skills

Based on Vercel's findings:

### Use AGENTS.md for:

- **Broad, horizontal improvements** - General framework knowledge that applies across all tasks
- **Version-specific APIs** - Framework features not in training data
- **Project conventions** - How your team structures code
- **Always-needed context** - Information agents need on every turn

### Use Skills for:

- **Vertical, action-specific workflows** - Tasks users explicitly trigger
- **Complex multi-step operations** - "Upgrade my Next.js version", "Migrate to App Router"
- **Framework best practices application** - Automated code reviews and refactors
- **Tool integrations** - Deployments, monitoring, external APIs

The two approaches complement each other. AGENTS.md provides the foundation, skills provide specialized workflows.

## Testing Your AGENTS.md

### Build Evaluation Tests

1. **Target APIs not in training data** - This is where doc access matters most
2. **Test across Build/Lint/Test phases** - Ensure code compiles, passes linting, and tests pass
3. **Use consistent prompts** - Avoid ambiguity in your test cases
4. **Validate behavior, not implementation** - Test what the code does, not how it does it

### Measure Impact

Compare agent performance with and without your AGENTS.md:

- Code correctness
- Build success rate
- Test pass rate
- Time to completion
- Number of iterations needed

## Common Pitfalls

### 1. Too Much Context

**Problem:** Embedding 100KB of documentation
**Solution:** Compress to index format, aim for <10KB

### 2. Outdated Information

**Problem:** AGENTS.md references old framework version
**Solution:** Update when dependencies change, automate with CI

### 3. Ambiguous Guidance

**Problem:** "Use modern patterns"
**Solution:** "Use Server Components by default; mark with 'use client' only when needed"

### 4. Missing Framework Version

**Problem:** Agent uses wrong APIs
**Solution:** Always specify exact versions

### 5. No Retrieval Instruction

**Problem:** Agent still uses training data
**Solution:** Add explicit "prefer retrieval-led reasoning" instruction

## Maintaining AGENTS.md

### When to Update

- Framework version changes
- New APIs are introduced
- Project conventions evolve
- Team discovers common agent mistakes
- Performance issues emerge

### Update Workflow

```bash
# 1. Update framework
npm update next react react-dom

# 2. Regenerate docs (if automated)
npx @next/codemod@canary agents-md

# 3. Test with agents
# Run your eval suite

# 4. Commit changes
git add AGENTS.md .next-docs/
git commit -m "Update AGENTS.md for Next.js 16.1"
```

## Real-World Results

From Vercel's evaluation:

| Configuration             | Pass Rate | vs Baseline |
| ------------------------- | --------- | ----------- |
| Baseline (no docs)        | 53%       | —           |
| Skill (default)           | 53%       | +0pp        |
| Skill (with instructions) | 79%       | +26pp       |
| **AGENTS.md**             | **100%**  | **+47pp**   |

Detailed breakdown:

| Configuration        | Build    | Lint     | Test     |
| -------------------- | -------- | -------- | -------- |
| Baseline             | 84%      | 95%      | 63%      |
| Skill (default)      | 84%      | 89%      | 58%      |
| Skill (instructions) | 95%      | 100%     | 84%      |
| **AGENTS.md**        | **100%** | **100%** | **100%** |

## Advanced Techniques

### Multi-Framework Projects

If your project uses multiple frameworks:

```markdown
## Framework Documentation

[Next.js 16]|root: ./.next-docs|[compressed index]
[React 18]|root: ./.react-docs|[compressed index]
[Tailwind 3.4]|root: ./.tailwind-docs|[compressed index]
```

### Conditional Guidance

```markdown
## Platform-Specific Notes

When deploying to Vercel:

- Edge Functions: Use `export const runtime = 'edge'`
- Image Optimization: Built-in, no config needed

When deploying to other platforms:

- May need custom image optimization
- Check Node.js version compatibility
```

### Progressive Disclosure

Point to detailed docs rather than including everything:

```markdown
## Detailed Guides

For component patterns: See `./.docs/components.md`
For API design: See `./.docs/api-guidelines.md`
For testing: See `./.docs/testing-strategy.md`
```

## Conclusion

AGENTS.md is currently the most reliable way to shift agents from pre-training-led to retrieval-led reasoning. By providing compressed, version-specific documentation as passive context, you eliminate the unreliability of skill invocation while keeping context overhead minimal.

**Key takeaways:**

1. Passive context (AGENTS.md) outperforms active retrieval (skills) for general framework knowledge
2. Compression is critical - aim for <10KB through index-based approach
3. Explicitly instruct agents to prefer retrieval over pre-training
4. Test with evals targeting APIs no in training data
5. Use skills for vertical workflows, AGENTS.md for horizontal knowledge

Start with the basics, test with real agent workflows, and iterate based on results. The goal is to make your agents more reliable and your team more productive.

---

_Based on research by Jude Gao and the Vercel team. Read the full article: [AGENTS.md outperforms skills in our agent evals](https://vercel.com/blog/agents-md-outperforms-skills-in-our-agent-evals)_
